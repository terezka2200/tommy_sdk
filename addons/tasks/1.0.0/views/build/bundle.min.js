!function s(o,d,l){function r(e,t){if(!d[e]){if(!o[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=d[e]={exports:{}};o[e][0].call(i.exports,function(t){return r(o[e][1][t]||t)},i,i.exports,s,o,d,l)}return d[e].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)r(l[t]);return r}({1:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("./controllers/index"),s=(n=i)&&n.__esModule?n:{default:n};var o={listsLoaded:!1,tasksLoaded:!1,cache:{},initCache:function(){o.cache={lists:{},tasks:{}}},addTask:function(t){o.cache.tasks[t.id]=t},addTasks:function(t){if(o.tasksLoaded=!0,t&&t.length)for(var e=0;e<t.length;e++)o.addTask(t[e])},getListTasks:function(t){var e=[],a=void 0;for(var n in o.cache.tasks)(a=o.cache.tasks[n]).parent_id==t&&e.push(a);return e},loadTasks:function(t){return console.log("load tasks",t),t=Object.assign({addon:"tasks",kind:"Task"},t),window.tommy.api.getFragments(t).then(o.addTasks)},addTaskActivity:function(t,e,a){var n=window.tommy.config.getCurrentUser(),i={type:e,text:a,time:new Date,user_id:n.id,user_name:n.first_name};return t.data||(t.data={}),console.log(t),t.data.activity||(t.data.activity=[]),t.data.activity.unshift(i),i},saveTask:function(t){if(console.log("save task",t),t.name){if(t.parent_id){t.addon="tasks",t.kind="Task",t.id||o.addTaskActivity(t,"status","Created a task");var e=Object.assign({},t,{data:JSON.stringify(t.data)});return t.id?window.tommy.api.updateFragment(t.id,e).then(o.addTask):window.tommy.api.createFragment(e).then(o.addTask)}alert("Task must belong to a list")}else alert("Task name must be set")},addList:function(t){o.cache.lists[t.id]=t,console.log("added task list",t)},addLists:function(t){if(o.listsLoaded=!0,t&&t.length)for(var e=0;e<t.length;e++)o.addList(t[e])},loadLists:function(t){return console.log("load task lists",t),t=Object.assign({addon:"tasks",kind:"TaskList"},t),window.tommy.api.getFragments(t).then(o.addLists)},deleteList:function(t){return delete o.cache.lists[t],console.log("delete list",t),window.tommy.api.deleteFragment(t)},saveList:function(t){console.log("save list",t),s.default.invalidateLists=!0,t.addon="tasks",t.kind="TaskList",t.data||(t.data={}),void 0===t.data.order&&(t.data.order=Object.keys(o.cache.lists).length),void 0===t.data.active&&(t.data.active=!0),void 0===t.data.show_fast_add&&(t.data.show_fast_add=!0);var e=Object.assign({},t,{data:JSON.stringify(t.data)});return t.id?window.tommy.api.updateFragment(t.id,e).then(o.addList):window.tommy.api.createFragment(e).then(o.addList)},createDefaultList:function(){return console.log("creating deafult task list"),o.saveList({name:window.tommy.i18n.t("index.default-task-name")})},hasLists:function(){return 0<Object.keys(o.cache.lists).length},initPermissionSelects:function(a,n){window.tommy.api.getInstalledAddonPermissions("tasks",{cache:!0}).then(function(t){console.log("installed addon permissions",t),t=t.filter(function(t){return-1!==n.indexOf(t.name)}),window.tommy.tplManager.renderInline("tasks__permissionsTagSelectTemplate",t,a.container);for(var e=0;e<t.length;e++)o.initTagSelect(a,t[e])})},initTagSelect:function(t,e){var a=$$(t.container).find('.tag-select[data-permission-name="'+e.name+'"]');console.log("init tag select",e,a),window.tommy.tagSelect.initWidget(a,e.filters,function(t){console.log("save tags",e,t,a.dataset()),window.tommy.api.updateInstalledAddonPermission("tasks",e.name,{filters:JSON.stringify(t)})})}};a.default=o},{"./controllers/index":3}],2:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var o={init:function(t){var e=$$(t.container),a=$$(t.navbarInnerContainer);window.tommy.tplManager.renderInline("tasks__boardSettingTemplate",null,e),s.default.initPermissionSelects(t,["task_create_access","task_edit_access"]),a.find("a.save").on("click",function(t){window.tommy.app.f7.formToJSON(e.find("form"));t.preventDefault()})},saveList:function(){},afterSave:function(t){}};a.default=o},{"../api":1}],3:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),o=(n=i)&&n.__esModule?n:{default:n};var d={init:function(t){o.default.listsLoaded&&o.default.tasksLoaded||(o.default.initCache(),o.default.loadLists().then(function(){o.default.hasLists()?d.invalidate(t):o.default.createDefaultList().then(function(){d.invalidate(t)})}),o.default.loadTasks().then(function(){d.invalidate(t)})),d.bind(t)},uninit:function(){console.log("tasks uninitialize"),o.default.cache={}},bind:function(a){var t=$$(a.container);t.find(".list-content").each(function(){var t=$$(this);t[0].scrollHeight>=t[0].clientHeight&&t.parent().addClass("hasScroll")}),t.on("click",".fast-add-toggle",function(){var t=$$(this),e=t.closest(".in").removeClass("in").siblings().addClass("in");t.data("input-focus")&&e.find("input").focus()}),t.on("submit","form.fast-add-form",function(t){t.preventDefault();var e=window.tommy.app.f7.formToJSON(this);$$(this).find('input[name="name"]').val(""),o.default.saveTask(e).then(function(){d.invalidate(a)})})},invalidate:function(t){console.log("invalidating tasks index");var e=$$(t.container);if(d.invalidateLists||!e.find(".card").length){d.invalidateLists=!1,window.tommy.tplManager.renderInline("tasks__listsTemplate",o.default.cache.lists,t.container);var a=630<=window.innerWidth;window.tommy.app.f7.swiper(".swiper-container",{centeredSlides:!a,spaceBetween:0,freeMode:!1,freeModeSticky:!0,slidesPerView:"auto"})}for(var n in o.default.cache.lists){var i=$$(t.container).find('[data-list-id="'+n+'"] .list-content'),s=o.default.getListTasks(n);window.tommy.tplManager.renderTarget("tasks__listTasksTemplate",s,i)}}};a.default=d},{"../api":1}],4:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var o={init:function(t){var a=$$(t.container);$$(t.navbarInnerContainer).find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(a.find("form"));o.saveList(e),t.preventDefault()})},saveList:function(t){var e={};e.name=t.name,s.default.saveList(e).then(o.afterSave)},afterSave:function(t){console.log("list saved",t),window.tommy.app.f7view.router.back()}};a.default=o},{"../api":1}],5:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=n(t("../api")),s=n(t("./index"));function n(t){return t&&t.__esModule?t:{default:t}}var o={init:function(t){var a=i.default.cache.lists[t.query.list_fragment_id],n=$$(t.container),e=$$(t.navbarInnerContainer);console.log("edit list",a),window.tommy.tplManager.renderInline("tasks__listEditTemplate",a,n),i.default.initPermissionSelects(t,["task_list_read_access","task_list_edit_access"]),e.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(n.find("form"));o.saveList(a,e),t.preventDefault()}),n.find(".delete-list").on("click",function(t){i.default.deleteList(a.id),s.default.invalidateLists=!0,window.tommy.app.f7view.router.back(),t.preventDefault()})},saveList:function(t,e){t.name=e.name,t.data.show_fast_add=!(!e.show_fast_add||!e.show_fast_add.length),i.default.saveList(t).then(o.afterSave)},afterSave:function(t){console.log("list saved",t),window.tommy.app.f7view.router.back()}};a.default=o},{"../api":1,"./index":3}],6:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var o={init:function(a){var n=$$(a.container),t=$$(a.navbarInnerContainer);window.tommy.tplManager.renderInline("tasks__listManagementTemplate",s.default.cache.lists,n),t.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(n.find("form"));o.save(a,e),t.preventDefault()})},save:function(t,e){var a=$$(t.container),i=!1;a.find(".sortable [data-list-id]").each(function(t){var e=$$(this),a=s.default.cache.lists[e.data("list-id")],n=e.find('input[type="checkbox"]')[0].checked;a.data.order==t&&a.data.active==n||(a.data.order=t,a.data.active=n,s.default.saveList(a),console.log("updated list",a),i||(i=!0,window.tommy.app.f7view.router.back()))})}};a.default=o},{"../api":1}],7:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var o={init:function(t){var a=$$(t.container),e=$$(t.navbarInnerContainer);window.tommy.tplManager.renderInline("tasks__addTaskTemplate",s.default.cache.lists,a),e.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(a.find("form"));o.saveTask(e),t.preventDefault()})},saveTask:function(t){s.default.saveTask(t).then(o.afterSave)},afterSave:function(t){console.log("task saved",t),window.tommy.app.f7view.router.back()}};a.default=o},{"../api":1}],8:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),d=(n=i)&&n.__esModule?n:{default:n};var l={init:function(e){var a=d.default.cache.tasks[e.query.task_fragment_id],n=$$(e.container),i=$$(e.navbarInnerContainer);console.log("init task details",a),window.tommy.tplManager.renderInline("tasks__taskDetailsTemplate",a,n.parent()),n.find(".task-menu-popover a").click(function(){switch($$(this).data("command")){case"add-checklist":l.renderChecklist(e);break;case"add-end-time":l.renderDeadline(e)}window.tommy.app.f7.closeModal()}),n.find(".page-content").scroll(function(t){100<t.target.scrollTop?i.addClass("with-title"):i.removeClass("with-title")}),l.initStatusPicker(e),a.data.checklist&&a.data.checklist.items&&l.renderChecklist(e),a.data.deadline&&l.renderDeadline(e);var t=window.tommy.app.f7.messagebar(".messagebar",{maxHeight:200});n.find(".add-comment").click(function(){l.addActivity(e,"comment",t.value()),t.clear()}),l.renderActivity(e);var s=n.find(".tag-select"),o=[];a.data.participants&&(o=a.data.participants),window.tommy.tplManager.renderInline("tasks__taskParticipantsTemplate",o,n),window.tommy.tagSelect.initWidget(s,o,function(t){console.log("task participants changed",t),a.data.participants=t,window.tommy.tplManager.renderInline("tasks__taskParticipantsTemplate",a.data.participants,n),l.enableSave(e,!0)}),n.find("input.edit-task-name").on("click",function(){l.enableEditName(e,!0)}),n.find("textarea.edit-task-description").on("click",function(){l.enableEditDescription(e,!0)}),i.find("a.save").on("click",function(){l.saveTask(e),l.enableSave(e,!1)})},invalidate:function(t){var e=d.default.cache.tasks[t.query.task_fragment_id];window.tommy.app.setPageTitle(e.name)},renderActivity:function(t){var e=d.default.cache.tasks[t.query.task_fragment_id],a=$$(t.container),n=[];e.data.activity&&(n=e.data.activity),window.tommy.tplManager.renderInline("tasks__taskActivityTemplate",n,a)},addActivity:function(t,e,a){var n=d.default.cache.tasks[t.query.task_fragment_id];d.default.addTaskActivity(n,e,a),l.renderActivity(t),l.saveTask(t)},renderChecklist:function(a){var n=d.default.cache.tasks[a.query.task_fragment_id],t=$$(a.container),e=[];n.data.checklist&&n.data.checklist.items&&(e=n.data.checklist.items),window.tommy.tplManager.renderInline("tasks__taskChecklistTemplate",e,t);var i=t.find("input.add-checklist-item");i.on("focusout",function(){var t=$$(this).val();t&&t.length&&(n.data.checklist||(n.data.checklist={}),n.data.checklist.items||(n.data.checklist.items=[]),n.data.checklist.items.push({text:t,complete:!1}),l.renderChecklist(a))}),i.on("focusin",function(){l.enableSave(a)}),t.find(".remove-checklist").click(function(){n.data.checklist={},t.find('[data-template="tasks__taskChecklistTemplate"]').html(""),l.saveTask(a)}),t.find(".remove-checklist-item").click(function(){var t=parseInt($$(this).parents("li").data("checklist-item"));console.log("removing checklist item",t),n.data.checklist.items.splice(t,1),l.renderChecklist(a),l.enableSave(a)}),t.find(".checklist-item").click(function(){var t=parseInt($$(this).parents("li").data("checklist-item")),e=$$(this).hasClass("checked");console.log("toggle checklist item",t),e?($$(this).removeClass("checked"),n.data.checklist.items[t].complete=!1):($$(this).addClass("checked"),n.data.checklist.items[t].complete=!0),l.enableSave(a)})},renderDeadline:function(t){var e=d.default.cache.tasks[t.query.task_fragment_id],a=$$(t.container);window.tommy.tplManager.renderInline("tasks__taskDeadlineTemplate",e.data.deadline,a);var n=a.find("input.edit-task-deadline"),i=window.tommy.util.createDatePicker(n,e.data.deadline,{onClose:function(){console.log("closing deadline picker",i.currentDate),e.data.deadline=i.currentDate,l.enableSave(t)},onFormat:function(t){return console.log("format deadline picker",t),window.tommy.util.humanTime(t)}});e.data.deadline||n.val(""),a.on("click",".remove-deadline",function(){delete e.data.deadline,a.find('[data-template="tasks__taskDeadlineTemplate"]').html(""),l.saveTask(t)})},initStatusPicker:function(a){var n=d.default.cache.tasks[a.query.task_fragment_id];return window.tommy.app.f7.picker({input:$$(a.container).find(".task-status-picker"),value:[n.data.status],convertToPopover:!1,cols:[{textAlign:"center",values:["Unassigned","Assigned","Processing","Completed","Closed","Archive Task","Cancel"]}],onClose:function(t){var e=t.value[0];e!=n.data.status&&(n.data.status=e,l.addActivity(a,"status","Changed status to "+n.data.status),l.saveTask(a))}})},saveTask:function(t){var e=d.default.cache.tasks[t.query.task_fragment_id];console.log("saving task fragment",e),d.default.saveTask(e)},enableEditName:function(t,e){var a=d.default.cache.tasks[t.query.task_fragment_id],n=$$(t.container).find("input.edit-task-name");0!=e&&(l.enableSave(t,!0),n.on("focusout",function(){a.name=n.val(),console.log("set task name",a.name)}))},enableEditDescription:function(t,e){var a=d.default.cache.tasks[t.query.task_fragment_id],n=$$(t.container).find("textarea.edit-task-description");0!=e&&(l.enableSave(t,!0),n.on("focusout",function(){a.data.description=n.val(),console.log("set task description",a.data.description),l.enableEditDescription(t,!1)}))},enableSave:function(t,e){var a=$$(t.navbarInnerContainer).find("a.save");0!=e?(a.siblings().hide(),a.css("display","flex")):(a.siblings().css("display","flex"),a.hide())}};a.default=l},{"../api":1}],9:[function(t,e,a){"use strict";var n=c(t("./controllers/index")),i=c(t("./controllers/task")),s=c(t("./controllers/task-add")),o=c(t("./controllers/list-add")),d=c(t("./controllers/list-edit")),l=c(t("./controllers/list-management")),r=c(t("./controllers/board-settings"));function c(t){return t&&t.__esModule?t:{default:t}}window.tommy.app.f7.onPageInit("tasks__index",n.default.init),window.tommy.app.f7.onPageBack("tasks__index",n.default.uninit),window.tommy.app.f7.onPageAfterAnimation("tasks__index",n.default.invalidate),window.tommy.app.f7.onPageInit("tasks__board-settings",r.default.init),window.tommy.app.f7.onPageInit("tasks__list-add",o.default.init),window.tommy.app.f7.onPageInit("tasks__list-edit",d.default.init),window.tommy.app.f7.onPageInit("tasks__list-management",l.default.init),window.tommy.app.f7.onPageAfterAnimation("tasks__list-management",l.default.init),window.tommy.app.f7.onPageInit("tasks__task-add",s.default.init),window.tommy.app.f7.onPageInit("tasks__task",i.default.init),window.tommy.app.f7.onPageAfterAnimation("tasks__task",i.default.invalidate),window.tommy.app.t7.registerHelper("tasks__checklistNumCompleted",function(t){var e="";t&&t.items&&(e+=t.items.filter(function(t){return t.complete}).length,e+="/",e+=t.items.length);return e}),window.tommy.app.t7.registerHelper("tasks__displayStatus",function(t){return window.tommy.i18n.t("status."+window.tommy.util.underscore(t),{defaultValue:t})})},{"./controllers/board-settings":2,"./controllers/index":3,"./controllers/list-add":4,"./controllers/list-edit":5,"./controllers/list-management":6,"./controllers/task":8,"./controllers/task-add":7}]},{},[9]);