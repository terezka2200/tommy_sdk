!function s(d,o,r){function l(e,t){if(!o[e]){if(!d[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[e]={exports:{}};d[e][0].call(i.exports,function(t){return l(d[e][1][t]||t)},i,i.exports,s,d,o,r)}return o[e].exports}for(var c="function"==typeof require&&require,t=0;t<r.length;t++)l(r[t]);return l}({1:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i={listsLoaded:!1,tasksLoaded:!1,cache:{},initCache:function(){i.cache={lists:{},tasks:{}}},addTask:function(t){i.cache.tasks[t.id]=t,console.log("task added",t)},addTasks:function(t){if(i.tasksLoaded=!0,t&&t.length)for(var e=0;e<t.length;e++)i.addTask(t[e])},getListTasks:function(t){var e=[],a=void 0;for(var n in i.cache.tasks)(a=i.cache.tasks[n]).parent_id==t&&e.push(a);return e},loadTasks:function(t){return console.log("load tasks",t),t=Object.assign({addon:"tasks",kind:"Task"},t),window.tommy.api.getFragments(t).then(i.addTasks)},addTaskActivity:function(t,e,a){var n=window.tommy.config.getCurrentUser(),i={type:e,text:a,time:new Date,user_id:n.id,user_name:n.first_name};return t.data||(t.data={}),console.log(t),t.data.activity||(t.data.activity=[]),t.data.activity.unshift(i),i},saveTask:function(t){if(console.log("save task",t),t.name){if(t.parent_id){t.addon="tasks",t.kind="Task",t.id||i.addTaskActivity(t,"status","Created a task");var e=Object.assign({},t,{data:JSON.stringify(t.data)});return t.id?window.tommy.api.updateFragment(t.id,e).then(i.addTask):window.tommy.api.createFragment(e).then(i.addTask)}alert("Task must belong to a list")}else alert("Task name must be set")},addList:function(t){i.cache.lists[t.id]=t,console.log("added task list",t)},addLists:function(t){if(i.listsLoaded=!0,t&&t.length)for(var e=0;e<t.length;e++)i.addList(t[e])},loadLists:function(t){return console.log("load task lists",t),t=Object.assign({addon:"tasks",kind:"TaskList"},t),window.tommy.api.getFragments(t).then(i.addLists)},deleteList:function(t){return delete i.cache.lists[t],console.log("delete list",t),window.tommy.api.deleteFragment(t)},saveList:function(t){console.log("save list",t),t.addon="tasks",t.kind="TaskList",t.data||(t.data={}),void 0===t.data.order&&(t.data.order=Object.keys(i.cache.lists).length),void 0===t.data.active&&(t.data.active=!0),void 0===t.data.show_fast_add&&(t.data.show_fast_add=!0);var e=Object.assign({},t,{data:JSON.stringify(t.data)});return t.id?window.tommy.api.updateFragment(t.id,e).then(i.addList):window.tommy.api.createFragment(e).then(i.addList)}};a.default=i},{}],2:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api");(n=i)&&n.__esModule;var s={init:function(t){var e=$$(t.container),a=$$(t.navbarInnerContainer);window.tommy.tplManager.renderInline("tasks__boardSettingTemplate",null,e),a.find("a.save").on("click",function(t){window.tommy.app.f7.formToJSON(e.find("form"));alert("implement me"),t.preventDefault()})},saveList:function(){},afterSave:function(t){}};a.default=s},{"../api":1}],3:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),d=(n=i)&&n.__esModule?n:{default:n};var o={init:function(t){d.default.listsLoaded&&d.default.tasksLoaded||(d.default.initCache(),d.default.loadLists().then(function(){o.invalidate(t)}),d.default.loadTasks().then(function(){o.invalidate(t)})),o.bind(t)},uninit:function(){console.log("tasks uninitialize"),d.default.cache={}},bind:function(a){var t=$$(a.container);t.find(".list-content").each(function(){var t=$$(this);t[0].scrollHeight>=t[0].clientHeight&&t.parent().addClass("hasScroll")}),t.on("click",".fast-add-toggle",function(){var t=$$(this),e=t.closest(".in").removeClass("in").siblings().addClass("in");t.data("input-focus")&&e.find("input").focus()}),t.on("submit","form.fast-add-form",function(t){t.preventDefault();var e=window.tommy.app.f7.formToJSON(this);$$(this).find('input[name="name"]').val(""),d.default.saveTask(e).then(function(){o.invalidate(a)})})},invalidate:function(t){console.log("invalidating tasks index");var e=$$(t.container);if(o.invalidateLists||!e.find(".card").length){o.invalidateLists=!1,window.tommy.tplManager.renderInline("tasks__listsTemplate",d.default.cache.lists,t.container);var a=630<=window.innerWidth;window.tommy.app.f7.swiper(".swiper-container",{centeredSlides:!a,spaceBetween:0,freeMode:!1,freeModeSticky:!0,slidesPerView:"auto"})}for(var n in d.default.cache.lists){var i=$$(t.container).find('[data-list-id="'+n+'"] .list-content'),s=d.default.getListTasks(n);window.tommy.tplManager.renderTarget("tasks__listTasksTemplate",s,i)}}};a.default=o},{"../api":1}],4:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var d={init:function(t){var a=$$(t.container);$$(t.navbarInnerContainer).find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(a.find("form"));d.saveList(e),t.preventDefault()})},saveList:function(t){var e={};e.name=t.name,s.default.saveList(e).then(d.afterSave)},afterSave:function(t){console.log("list saved",t),window.tommy.app.f7view.router.back()}};a.default=d},{"../api":1}],5:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var d={init:function(t){var a=s.default.cache.lists[t.query.list_fragment_id],n=$$(t.container),e=$$(t.navbarInnerContainer);console.log("edit list",a),window.tommy.tplManager.renderInline("tasks__listEditTemplate",a,n),e.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(n.find("form"));d.saveList(a,e),t.preventDefault()}),n.find(".delete-list").on("click",function(t){s.default.deleteList(a.id),IndexController.invalidateLists=!0,window.tommy.app.f7view.router.back(),t.preventDefault()})},saveList:function(t,e){t.name=e.name,t.data.show_fast_add=!(!e.show_fast_add||!e.show_fast_add.length),s.default.saveList(t).then(d.afterSave)},afterSave:function(t){console.log("list saved",t),window.tommy.app.f7view.router.back()}};a.default=d},{"../api":1}],6:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var d={init:function(a){var n=$$(a.container),t=$$(a.navbarInnerContainer);window.tommy.tplManager.renderInline("tasks__listManagementTemplate",s.default.cache.lists,n),t.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(n.find("form"));d.save(a,e),t.preventDefault()})},save:function(t,e){var a=$$(t.container),i=!1;a.find(".sortable [data-list-id]").each(function(t){var e=$$(this),a=s.default.cache.lists[e.data("list-id")],n=e.find('input[type="checkbox"]')[0].checked;a.data.order==t&&a.data.active==n||(a.data.order=t,a.data.active=n,s.default.saveList(a),console.log("updated list",a),i||(i=!0,window.tommy.app.f7view.router.back()))})}};a.default=d},{"../api":1}],7:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),s=(n=i)&&n.__esModule?n:{default:n};var d={init:function(t){var a=$$(t.container),e=$$(t.navbarInnerContainer);window.tommy.tplManager.renderInline("tasks__addTaskTemplate",s.default.cache.lists,a),e.find("a.save").on("click",function(t){var e=window.tommy.app.f7.formToJSON(a.find("form"));d.saveTask(e),t.preventDefault()})},saveTask:function(t){s.default.saveTask(t).then(d.afterSave)},afterSave:function(t){console.log("task saved",t),window.tommy.app.f7view.router.back()}};a.default=d},{"../api":1}],8:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=t("../api"),o=(n=i)&&n.__esModule?n:{default:n};var r={init:function(e){var a=o.default.cache.tasks[e.query.task_fragment_id],n=$$(e.container),i=$$(e.navbarInnerContainer);console.log("init task details",a),window.tommy.tplManager.renderInline("tasks__taskDetailsTemplate",a,n.parent()),n.find(".task-menu-popover a").click(function(){switch($$(this).data("command")){case"add-checklist":r.renderChecklist(e);break;case"add-end-time":r.renderDeadline(e)}window.tommy.app.f7.closeModal()}),n.find(".page-content").scroll(function(t){100<t.target.scrollTop?i.addClass("with-title"):i.removeClass("with-title")}),r.initStatusPicker(e),a.data.checklist&&a.data.checklist.items&&r.renderChecklist(e),a.data.deadline&&r.renderDeadline(e);var t=window.tommy.app.f7.messagebar(".messagebar",{maxHeight:200});n.find(".add-comment").click(function(){r.addActivity(e,"comment",t.value()),t.clear()}),r.renderActivity(e);var s=n.find(".tag-select"),d=[];a.data.participants&&(d=a.data.participants),window.tommy.tplManager.renderInline("tasks__taskParticipantsTemplate",d,n),window.tommy.tagSelect.initWidget(s,d,function(t){console.log("task participants changed",t),a.data.participants=t,window.tommy.tplManager.renderInline("tasks__taskParticipantsTemplate",a.data.participants,n),r.enableSave(e,!0)}),n.find("input.edit-task-name").on("click",function(){r.enableEditName(e,!0)}),n.find("textarea.edit-task-description").on("click",function(){r.enableEditDescription(e,!0)}),i.find("a.save").on("click",function(){r.saveTask(e),r.enableSave(e,!1)})},invalidate:function(t){var e=o.default.cache.tasks[t.query.task_fragment_id];window.tommy.app.setPageTitle(e.name)},renderActivity:function(t){var e=o.default.cache.tasks[t.query.task_fragment_id],a=$$(t.container),n=[];e.data.activity&&(n=e.data.activity),window.tommy.tplManager.renderInline("tasks__taskActivityTemplate",n,a)},addActivity:function(t,e,a){var n=o.default.cache.tasks[t.query.task_fragment_id];o.default.addTaskActivity(n,e,a),r.renderActivity(t),r.saveTask(t)},renderChecklist:function(a){var n=o.default.cache.tasks[a.query.task_fragment_id],t=$$(a.container),e=[];n.data.checklist&&n.data.checklist.items&&(e=n.data.checklist.items),window.tommy.tplManager.renderInline("tasks__taskChecklistTemplate",e,t);var i=t.find("input.add-checklist-item");i.on("focusout",function(){var t=$$(this).val();t&&t.length&&(n.data.checklist||(n.data.checklist={}),n.data.checklist.items||(n.data.checklist.items=[]),n.data.checklist.items.push({text:t,complete:!1}),r.renderChecklist(a))}),i.on("focusin",function(){r.enableSave(a)}),t.find(".remove-checklist").click(function(){n.data.checklist={},t.find('[data-template="tasks__taskChecklistTemplate"]').html(""),r.saveTask(a)}),t.find(".remove-checklist-item").click(function(){var t=parseInt($$(this).parents("li").data("checklist-item"));console.log("removing checklist item",t),n.data.checklist.items.splice(t,1),r.renderChecklist(a),r.enableSave(a)}),t.find(".checklist-item").click(function(){var t=parseInt($$(this).parents("li").data("checklist-item")),e=$$(this).hasClass("checked");console.log("toggle checklist item",t),e?($$(this).removeClass("checked"),n.data.checklist.items[t].complete=!1):($$(this).addClass("checked"),n.data.checklist.items[t].complete=!0),r.enableSave(a)})},renderDeadline:function(t){var e=o.default.cache.tasks[t.query.task_fragment_id],a=$$(t.container);window.tommy.tplManager.renderInline("tasks__taskDeadlineTemplate",e.data.deadline,a);var n=a.find("input.edit-task-deadline"),i=window.tommy.util.createDatePicker(n,e.data.deadline,{onClose:function(){console.log("closing deadline picker",i.currentDate),e.data.deadline=i.currentDate,r.enableSave(t)},onFormat:function(t){return console.log("format deadline picker",t),window.tommy.util.humanTime(t)}});e.data.deadline||n.val(""),a.on("click",".remove-deadline",function(){delete e.data.deadline,a.find('[data-template="tasks__taskDeadlineTemplate"]').html(""),r.saveTask(t)})},initStatusPicker:function(a){var n=o.default.cache.tasks[a.query.task_fragment_id];return window.tommy.app.f7.picker({input:$$(a.container).find(".task-status-picker"),value:[n.data.status],convertToPopover:!1,cols:[{textAlign:"center",values:["Unassigned","Assigned","Processing","Completed","Closed","Archive Task","Cancel"]}],onClose:function(t){var e=t.value[0];e!=n.data.status&&(n.data.status=e,r.addActivity(a,"status","Changed status to "+n.data.status),r.saveTask(a))}})},saveTask:function(t){var e=o.default.cache.tasks[t.query.task_fragment_id];console.log("saving task fragment",e),o.default.saveTask(e)},enableEditName:function(t,e){var a=o.default.cache.tasks[t.query.task_fragment_id],n=$$(t.container).find("input.edit-task-name");0!=e&&(r.enableSave(t,!0),n.on("focusout",function(){a.name=n.val(),console.log("set task name",a.name)}))},enableEditDescription:function(t,e){var a=o.default.cache.tasks[t.query.task_fragment_id],n=$$(t.container).find("textarea.edit-task-description");0!=e&&(r.enableSave(t,!0),n.on("focusout",function(){a.data.description=n.val(),console.log("set task description",a.data.description),r.enableEditDescription(t,!1)}))},enableSave:function(t,e){var a=$$(t.navbarInnerContainer).find("a.save");0!=e?(a.siblings().hide(),a.css("display","flex")):(a.siblings().css("display","flex"),a.hide())}};a.default=r},{"../api":1}],9:[function(t,e,a){"use strict";var n=c(t("./controllers/index")),i=c(t("./controllers/task")),s=c(t("./controllers/task-add")),d=c(t("./controllers/list-add")),o=c(t("./controllers/list-edit")),r=c(t("./controllers/list-management")),l=c(t("./controllers/board-setting"));function c(t){return t&&t.__esModule?t:{default:t}}window.tommy.app.f7.onPageInit("tasks__index",n.default.init),window.tommy.app.f7.onPageBack("tasks__index",n.default.uninit),window.tommy.app.f7.onPageAfterAnimation("tasks__index",n.default.invalidate),window.tommy.app.f7.onPageInit("tasks__board-setting",l.default.init),window.tommy.app.f7.onPageInit("tasks__list-add",d.default.init),window.tommy.app.f7.onPageInit("tasks__list-edit",o.default.init),window.tommy.app.f7.onPageInit("tasks__list-management",r.default.init),window.tommy.app.f7.onPageAfterAnimation("tasks__list-management",r.default.init),window.tommy.app.f7.onPageInit("tasks__task-add",s.default.init),window.tommy.app.f7.onPageInit("tasks__task",i.default.init),window.tommy.app.f7.onPageAfterAnimation("tasks__task",i.default.invalidate),window.tommy.app.t7.registerHelper("tasks__checklistNumCompleted",function(t){var e="";t&&t.items&&(e+=t.items.filter(function(t){return t.complete}).length,e+="/",e+=t.items.length);return e})},{"./controllers/board-setting":2,"./controllers/index":3,"./controllers/list-add":4,"./controllers/list-edit":5,"./controllers/list-management":6,"./controllers/task":8,"./controllers/task-add":7}]},{},[9]);